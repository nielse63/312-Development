language: node_js
node_js:
  - node
cache:
  yarn: true
  directories:
    - node_modules
    - "$HOME/.nvm"
dist: trusty
env:
  global:
    - JOBS=1
    - NODE_ENV=test

jobs:
  include:
    - stage: tests
      before_install:
        - npm i -g http-server
      script: &script
        - yarn test:unit
        - yarn test:e2e
      after_success:
        - npm i -g coveralls
        - cat coverage/lcov.info | coveralls
    - stage: greenkeeper
      if: branch =~ /^greenkeeper/
      before_install:
        - npm i -g greenkeeper-lockfile@2
      before_script:
        - greenkeeper-lockfile-update
      script:
        <<: *script
      after_script:
        - greenkeeper-lockfile-upload
