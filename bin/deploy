#!/usr/bin/env bash
set -e

if ! [ -f ".env" ]; then
  echo ".env file not found. exiting"
  exit 1
fi

if ! [ $(command -v now) ]; then
  npm i -g now
fi

function deploy_api
{
  if ! [ -f "packages/api-server" ]; then
    cp .env packages/api-server/.env
  fi
  cd packages/api-server
  now --token $NOW_TOKEN --public
  now --token $NOW_TOKEN alias
}

function usage() {
  echo "deploys the front and back ends of the application"
  echo " "
  echo "bin/deploy [command]"
  echo " "
  echo "commands:"
  echo "api                deploys the express-server backend"
  echo " "
  echo "help               displays usage"
  exit 0
}

if [ "$1" == "api" ]; then
  deploy_api
elif [ "$1" == "help" ]; then
  usage
else
  usage
  exit 1
fi
