#!/usr/bin/env bash
set -e

# set default env vars
if [ ! "$NODE_ENV" ]; then
  export NODE_ENV=test
fi

# print environment information
. bin/print-env

# only run locally
if [ ! "$TRAVIS" ]; then
  yarn run lint:js
  yarn run lint:internal

  # Remove old coverage reports
  rm -rf coverage/
fi

# run tests
node_modules/.bin/karma start test/unit/karma.conf.js

# report coverage
if [ "$TRAVIS" ]; then
  npm i -g coveralls
  cat coverage/lcov.info | coveralls
fi
