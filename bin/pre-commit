#!/usr/bin/env bash

# exit on failure
set -e

export NODE_ENV=production

# lint assets
yarn run lint:scss
yarn run lint:internal
yarn run lint:js

# ensure we can build
node --harmony --gc_interval=100 build/build.js

# move seo-related files
for file in {robots.txt,sitemap.xml}; do
  from="dist/static/$file"
  to="dist/$file"
  [ -f "$from" ] && mv "$from" "$to";
done;

# alter output html
node build/add-async.js
