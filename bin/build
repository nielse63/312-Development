#!/usr/bin/env bash
set -e

# run locally
if [ ! "$IS_HEROKU" ] && [ ! "$TRAVIS" ]; then
  rm -rf dist
  yarn run lint:js
  yarn run lint:scss
fi

# build for production
node --harmony --gc_interval=100 build/build.js

# move seo-related files
for file in {robots.txt,sitemap.xml}; do
  from="dist/static/$file"
  to="dist/$file"
  [ -f "$from" ] && mv "$from" "$to";
done;

# alter output html
node build/add-async.js
