#!/usr/bin/env bash

# exit on failure
set -e

NODE_ENV=production
export NODE_ENV=production

# Remove old dist files
rm -rf dist

# lint js and style
yarn run lint:js --fix
yarn run lint:scss

# build for production
node_modules/.bin/cross-env NODE_ENV=production node --harmony --gc_interval=100 build/build.js

# move seo-related files
for file in {robots.txt,sitemap.xml}; do
  from="dist/static/$file"
  to="dist/$file"
  [ -f "$from" ] && mv "$from" "$to";
done;

# alter output html
node build/add-async.js
